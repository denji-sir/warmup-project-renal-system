# Changelog

## [2025-01-25] - Исправление синтаксической ошибки в Session.php

### Бэкенд
- **Исправлена синтаксическая ошибка в Session.php**: Удалена дублированная сигнатура метода в `getFlash(string $type = null): array`
  - Файл: `core/Session.php`, строка 161
  - Ошибка: `public function getFlash(string $type = null): array $type = null): array`
  - Исправлено на: `public function getFlash(string $type = null): array`

### Команды для применения изменений
```bash
# Проверить синтаксис PHP
php -l core/Session.php

# Перезапустить сервер разработки
php -S localhost:8000 -t public
```

### Риски и откат
- **Риски**: Минимальные, исправление синтаксической ошибки
- **Откат**: Восстановить предыдущую версию файла из git истории

### Заметки по деплою
- Изменения не требуют дополнительных действий
- Убедиться в отсутствии PHP синтаксических ошибок

---

## [2025-01-25] - Улучшение дизайна с белым фоном

### Фронтенд
- **Обновлен дизайн с белым фоном**: Полностью переработан дизайн интерфейса для использования белого фона
  - Изменены CSS переменные `--bg-primary` и `--bg-tertiary` на белые цвета
  - Обновлены фоны для `html` и `body` элементов на чистый белый (#ffffff)
  - Удален радиальный градиент из `.hero::after` псевдо-элемента
  - Убран линейный градиент из `.section--muted` класса

- **Улучшена контрастность и читаемость**:
  - Обновлены цвета текста для лучшей читаемости на белом фоне
  - Изменены переменные `--text-primary`, `--text-secondary`, `--text-muted`
  - Улучшены цвета границ для лучшей видимости

- **Обновлены компоненты интерфейса**:
  - `.navbar`: белый полупрозрачный фон с улучшенными тенями
  - `.search-panel`: чистый белый фон с мягкими тенями
  - `.feature-card`: белый фон с тонкими границами
  - `.property-card`: белый фон с улучшенными тенями
  - `.hero-card`: белый фон с мягкими тенями

- **Улучшен макет**:
  - Увеличены отступы контейнера для лучшего расположения элементов
  - Обновлен `.container` класс с использованием `--space-lg` вместо `--space-md`

### Команды для применения изменений
```bash
# Изменения применяются автоматически при обновлении CSS файлов
# Перезагрузите страницу в браузере для просмотра изменений
```

### Риски и откат
- **Риски**: Минимальные, изменения касаются только CSS стилей
- **Откат**: Восстановить предыдущие значения CSS переменных и стилей из git истории

### Заметки по деплою
- Изменения не требуют перезапуска сервера
- Рекомендуется очистить кэш браузера для корректного отображения

---

## [2025-01-25] - Исправление JavaScript ошибок и PHP предупреждений

### Фронтенд
- **Исправлены JavaScript синтаксические ошибки**: Удалены некорректные Unicode символы из `public/assets/js/components.js` и `public/assets/js/main.js`
- **Скопированы недостающие статические файлы**: Добавлены отсутствующие CSS и JS файлы в директорию `public/assets/`

### Бэкенд  
- **Исправлены PHP предупреждения сессий**: Добавлена проверка `session_status() === PHP_SESSION_NONE` в `core/Session.php` для предотвращения вывода предупреждений в HTML
- **Исправлена функция `user()`**: Добавлены проверки на null в `core/helpers.php`
- **Исправлены пути к представлениям**: Обновлен `core/View.php` для корректной работы с путями к файлам представлений
- **Добавлены null-проверки в шаблоне**: Обновлен `resources/views/layouts/main.php` для предотвращения JavaScript ошибок

### Команды для применения изменений
```bash
# Перезапустить сервер разработки
php -S localhost:8000 -t public

# Проверить отсутствие ошибок в браузере
# Открыть http://localhost:8000
```

### Риски и откат
- **Риски**: Минимальные, исправления касаются только обработки ошибок
- **Откат**: Восстановить предыдущие версии файлов из git истории

### Заметки по деплою
- Убедиться, что все статические файлы скопированы корректно
- Проверить работу сессий в production окружении

---

## [2025-01-29] - Исправление ошибок загрузки статических файлов CSS и JS

### Фронтенд
- **Исправлены ошибки**: `net::ERR_ABORTED` для файлов CSS и JS, `SyntaxError: Invalid or unexpected token`
- **Проблема**: Отсутствовали файлы CSS и JS в папке `public/assets/`
- **Решение**: Скопированы файлы из `resources/assets/` в `public/assets/`
- **Файлы**:
  - `public/assets/css/main.css` - основные стили приложения
  - `public/assets/css/components.css` - стили компонентов
  - `public/assets/js/main.js` - основная JavaScript логика
  - `public/assets/js/components.js` - JavaScript компоненты недвижимости

### Команды для развертывания
```bash
# Копирование статических файлов
cp resources/assets/css/* public/assets/css/
cp resources/assets/js/* public/assets/js/

# Перезапуск сервера разработки
php -S localhost:8000 -t public
```

### Риски и откат
- **Риски**: Минимальные, изменения касаются только статических файлов
- **Откат**: Удалить скопированные файлы из `public/assets/`

### Заметки по деплою
- В продакшене рекомендуется использовать автоматизированную сборку через Makefile
- Проверить корректность загрузки всех статических ресурсов после развертывания

---

## [2025-01-29] - Исправление ошибки "Call to a member function hasRole() on null"

### Бэкенд
- **Исправлена ошибка**: "Call to a member function hasRole() on null" в `resources/views/layouts/main.php` строка 76
- **Изменения в файлах**:
  - `core/helpers.php`: Исправлена функция `user()` для корректного создания объекта User из массива данных
  - `resources/views/layouts/main.php`: Добавлены проверки на null перед вызовом `hasRole()`
- **Причина ошибки**: Функция `auth()->user()` возвращала массив данных, а не объект User, что приводило к ошибке при вызове метода `hasRole()`
- **Решение**: Модифицирована функция `user()` в `core/helpers.php` для создания объекта User из массива данных

### Команды для развертывания
```bash
# Обновление кода
git pull origin main

# Перезапуск сервера разработки
php -S localhost:8000 -t public
```

### Риски и откат
- **Риски**: Минимальные, изменения касаются только отображения пользовательского интерфейса
- **Откат**: Восстановить предыдущую версию файлов `core/helpers.php` и `resources/views/layouts/main.php`

### Заметки по деплою
- Изменения не требуют миграций базы данных
- Рекомендуется проверить корректность отображения пользовательского меню после развертывания

---

## [2025-01-29] - Исправление ошибки "View not found: home"

### Бэкенд
- **Исправлена ошибка**: "View not found: home" в `core/View.php` строка 30
- **Изменения в файлах**:
  - `core/View.php`: Исправлен путь к папке с представлениями с `__DIR__ . '/../app/Views'` на `__DIR__ . '/../resources/views'`
- **Причина ошибки**: Неправильно указанный путь к папке с представлениями в классе View
- **Решение**: Обновлен путь `viewPath` в конструкторе класса View

### Команды для развертывания
```bash
# Обновление кода
git pull origin main

# Перезапуск сервера разработки
php -S localhost:8000 -t public
```

### Риски и откат
- **Риски**: Минимальные, изменение касается только пути к файлам представлений
- **Откат**: Восстановить предыдущее значение `viewPath` в `core/View.php`

### Заметки по деплою
- Изменения не требуют миграций базы данных
- Убедиться, что все файлы представлений находятся в папке `resources/views`

---

## [2025-01-29] - Первоначальная настройка и заполнение базы данных

### Бэкенд (Backend)
- **Настройка базы данных**
  - Исправлена конфигурация подключения к MySQL в `database/seed.php`
  - Обновлены параметры подключения для MAMP MySQL (порт 8889)
  - Создана база данных `realestate` с кодировкой `utf8mb4_unicode_ci`

- **Создание структуры базы данных**
  - Применены миграции для создания таблиц: `users`, `categories`, `properties`, `property_images`
  - Настроены индексы и внешние ключи для оптимизации производительности

- **Исправление данных для заполнения**
  - Исправлены роли пользователей: заменены `admin/user` на `administrator/user`
  - Обновлены поля свойств недвижимости для соответствия схеме БД:
    - `area` → `area_total`
    - `build_year` → `year_built`
    - `address` → `full_address`
    - `realtor_id` → `user_id`
    - Удалено поле `owner_id` (отсутствует в схеме)
    - `is_new` → `status` со значением 'active'
  - Добавлены недостающие поля для изображений: `original_name`, `path`, `mime_type`, `size`

- **Успешное заполнение базы данных**
  - Созданы тестовые пользователи (администратор и обычные пользователи)
  - Добавлены категории недвижимости
  - Загружены объекты недвижимости с изображениями
  - Все данные корректно связаны через внешние ключи

- **Запуск сервера разработки**
  - Настроен PHP встроенный сервер на `http://localhost:8000`
  - Приложение успешно запущено и доступно

### Команды для развертывания
```bash
# Никаких дополнительных команд не требуется
# Изменения затрагивают только конфигурацию путей
```

### Команды для развертывания (v1.0.0)
```bash
# Создание базы данных
mysql -u root -p -e "CREATE DATABASE realestate CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"

# Применение миграций
php database/migrate.php

# Заполнение данными
php database/seed.php --fresh

# Запуск сервера разработки
php -S localhost:8000 -t public
```

### Риски и откат
- **Риски**: Минимальные, изменение затрагивает только путь к представлениям
- **Откат**: Изменить путь обратно на `__DIR__ . '/../app/Views'` в файле `core/View.php`

### Заметки по деплою
- Убедитесь, что все файлы представлений находятся в папке `resources/views`
- Проверьте работу всех страниц после развертывания

### Риски и откат (v1.0.0)
- **Риски**: 
  - Потеря данных при использовании `--fresh` флага
  - Необходимость правильной настройки MySQL соединения
- **Откат**: 
  - Восстановление из резервной копии БД
  - Откат миграций через `php database/migrate.php --rollback`

### Заметки по деплою (v1.0.0)
- Убедитесь в правильности настроек подключения к БД в `.env`
- Проверьте доступность MySQL сервера на указанном порту
- Рекомендуется создать резервную копию перед применением миграций